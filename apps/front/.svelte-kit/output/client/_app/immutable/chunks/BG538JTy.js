import{x as Q,y as re,z as K,l as O,A as te,B as se,g as U,C as ne,D as ie,H as le,E as X,F as L,G as x,I as fe,J as oe,K as q,M as ue,O as ce,P as z,m as de,Q as P,R as W,S as he,T as b,U as Z,V as ve,W as Y,X as pe,Y as J,Z as $,_ as _e,$ as Se,a0 as me,a1 as ge,a2 as Ee,u as Te,a3 as k,a4 as we}from"./BXFeFmkJ.js";function Me(i,a){return a}function Ae(i,a,e){for(var t=i.items,l=[],c=a.length,o=0;o<c;o++)Se(a[o].e,l,!0);var p=c>0&&l.length===0&&e!==null;if(p){var g=e.parentNode;me(g),g.append(e),t.clear(),A(i,a[0].prev,a[c-1].next)}ge(l,()=>{for(var m=0;m<c;m++){var h=a[m];p||(t.delete(h.k),A(i,h.prev,h.next)),$(h.e,!p)}})}function Oe(i,a,e,t,l,c=null){var o=i,p={flags:a,items:new Map,first:null},g=(a&k)!==0;if(g){var m=i;o=O?K(te(m)):m.appendChild(Q())}O&&se();var h=null,I=!1,E=new Map,C=ne(()=>{var d=e();return he(d)?d:d==null?[]:W(d)}),s,u;function f(){ye(u,s,p,E,o,l,a,t,e),c!==null&&(s.length===0?h?Z(h):h=q(()=>c(o)):h!==null&&ve(h,()=>{h=null}))}re(()=>{u??=Ee,s=U(C);var d=s.length;if(I&&d===0)return;I=d===0;let S=!1;if(O){var T=ie(o)===le;T!==(d===0)&&(o=X(),K(o),L(!1),S=!0)}if(O){for(var y=null,v,r=0;r<d;r++){if(x.nodeType===fe&&x.data===oe){o=x,S=!0,L(!1);break}var n=s[r],_=t(n,r);v=B(x,p,y,null,n,_,r,l,a,e),p.items.set(_,v),y=v}d>0&&K(X())}if(O)d===0&&c&&(h=q(()=>c(o)));else if(ue()){var N=new Set,D=ce;for(r=0;r<d;r+=1){n=s[r],_=t(n,r);var M=p.items.get(_)??E.get(_);M?(a&(Y|b))!==0&&j(M,n,r,a):(v=B(null,p,null,null,n,_,r,l,a,e,!0),E.set(_,v)),N.add(_)}for(const[w,H]of p.items)N.has(w)||D.skipped_effects.add(H.e);D.add_callback(f)}else f();S&&L(!0),U(C)}),O&&(o=x)}function ye(i,a,e,t,l,c,o,p,g){var m=(o&we)!==0,h=(o&(Y|b))!==0,I=a.length,E=e.items,C=e.first,s=C,u,f=null,d,S=[],T=[],y,v,r,n;if(m)for(n=0;n<I;n+=1)y=a[n],v=p(y,n),r=E.get(v),r!==void 0&&(r.a?.measure(),(d??=new Set).add(r));for(n=0;n<I;n+=1){if(y=a[n],v=p(y,n),r=E.get(v),r===void 0){var _=t.get(v);if(_!==void 0){t.delete(v),E.set(v,_);var N=f?f.next:s;A(e,f,_),A(e,_,N),V(_,N,l),f=_}else{var D=s?s.e.nodes_start:l;f=B(D,e,f,f===null?e.first:f.next,y,v,n,c,o,g)}E.set(v,f),S=[],T=[],s=f.next;continue}if(h&&j(r,y,n,o),(r.e.f&J)!==0&&(Z(r.e),m&&(r.a?.unfix(),(d??=new Set).delete(r))),r!==s){if(u!==void 0&&u.has(r)){if(S.length<T.length){var M=T[0],w;f=M.prev;var H=S[0],F=S[S.length-1];for(w=0;w<S.length;w+=1)V(S[w],M,l);for(w=0;w<T.length;w+=1)u.delete(T[w]);A(e,H.prev,F.next),A(e,f,H),A(e,F,M),s=M,f=F,n-=1,S=[],T=[]}else u.delete(r),V(r,s,l),A(e,r.prev,r.next),A(e,r,f===null?e.first:f.next),A(e,f,r),f=r;continue}for(S=[],T=[];s!==null&&s.k!==v;)(s.e.f&J)===0&&(u??=new Set).add(s),T.push(s),s=s.next;if(s===null)continue;r=s}S.push(r),f=r,s=r.next}if(s!==null||u!==void 0){for(var R=u===void 0?[]:W(u);s!==null;)(s.e.f&J)===0&&R.push(s),s=s.next;var G=R.length;if(G>0){var ee=(o&k)!==0&&I===0?l:null;if(m){for(n=0;n<G;n+=1)R[n].a?.measure();for(n=0;n<G;n+=1)R[n].a?.fix()}Ae(e,R,ee)}}m&&Te(()=>{if(d!==void 0)for(r of d)r.a?.apply()}),i.first=e.first&&e.first.e,i.last=f&&f.e;for(var ae of t.values())$(ae.e);t.clear()}function j(i,a,e,t){(t&Y)!==0&&z(i.v,a),(t&b)!==0?z(i.i,e):i.i=e}function B(i,a,e,t,l,c,o,p,g,m,h){var I=(g&Y)!==0,E=(g&pe)===0,C=I?E?de(l,!1,!1):P(l):l,s=(g&b)===0?o:P(o),u={i:s,v:C,k:c,a:null,e:null,prev:e,next:t};try{if(i===null){var f=document.createDocumentFragment();f.append(i=Q())}return u.e=q(()=>p(i,C,s,m),O),u.e.prev=e&&e.e,u.e.next=t&&t.e,e===null?h||(a.first=u):(e.next=u,e.e.next=u.e),t!==null&&(t.prev=u,t.e.prev=u.e),u}finally{}}function V(i,a,e){for(var t=i.next?i.next.e.nodes_start:e,l=a?a.e.nodes_start:e,c=i.e.nodes_start;c!==null&&c!==t;){var o=_e(c);l.before(c),c=o}}function A(i,a,e){a===null?i.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}class Ie{constructor(){this.scenes=new Map,this.chapters=new Map,this.STORAGE_KEY="loke-cards-data",this.loadFromStorage()}async createScene(a){const e=this.generateId(),t={...a,id:e};return this.scenes.set(e,t),this.saveToStorage(),t}async getScene(a){return this.scenes.get(a)||null}async updateScene(a,e){const t=this.scenes.get(a);if(!t)return null;const l={...t,...e};return this.scenes.set(a,l),this.saveToStorage(),l}async deleteScene(a){const e=this.scenes.delete(a);return e&&this.saveToStorage(),e}async getAllScenes(){return Array.from(this.scenes.values())}async createChapter(a){const e=this.generateId(),t={...a,id:e};return this.chapters.set(e,t),this.saveToStorage(),t}async getChapter(a){return this.chapters.get(a)||null}async updateChapter(a,e){const t=this.chapters.get(a);if(!t)return null;const l={...t,...e};return this.chapters.set(a,l),this.saveToStorage(),l}async deleteChapter(a){const e=this.chapters.delete(a);return e&&this.saveToStorage(),e}async getAllChapters(){return Array.from(this.chapters.values())}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveToStorage(){if(!(typeof window>"u"))try{const a={scenes:Array.from(this.scenes.entries()),chapters:Array.from(this.chapters.entries())};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a))}catch(a){console.error("Failed to save to localStorage:",a)}}loadFromStorage(){if(!(typeof window>"u"))try{const a=localStorage.getItem(this.STORAGE_KEY);if(a){const e=JSON.parse(a);this.scenes=new Map(e.scenes||[]),this.chapters=new Map(e.chapters||[])}}catch(a){console.error("Failed to load from localStorage:",a)}}async clear(){this.scenes.clear(),this.chapters.clear(),typeof window<"u"&&localStorage.removeItem(this.STORAGE_KEY)}}const Ne=new Ie;export{Ne as d,Oe as e,Me as i};
