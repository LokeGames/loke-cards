import"./DsnmJJEf.js";import{i as j}from"./C0onhL4A.js";import{p as z,aN as O,f as C,c as m,a as p,ad as R,aa as L,r as f,b as w,d as B,g as t,t as M,aC as D,e as $,aO as X,aP as Y,aB as F,m as E,aL as J,h as A,o as ee,i as U,aQ as ae}from"./BXFeFmkJ.js";import{i as H}from"./CiKQ9KvB.js";import{e as q,i as G,d as N}from"./BG538JTy.js";import{p as I}from"./D9o7MBRo.js";import{r as K,s as Q,a as re}from"./CWcAXP6L.js";import{s as W}from"./B0Uv51C4.js";import{c as V,b as ne}from"./Ctl9s4e4.js";var le=C('<button class="underline hover:no-underline"> </button>'),se=C('<span aria-current="page"> </span>'),ie=C('<span class="px-2 text-gray-400">/</span>'),oe=C('<span class="inline-flex items-center"><!> <!></span>'),ce=C("<span>Home</span>"),de=C('<nav aria-label="Breadcrumb" class="text-sm text-gray-600 dark:text-gray-300 py-1"><!> <!></nav>');function Pe(c,r){z(r,!1);let e=I(r,"items",24,()=>[]);const d=O();function i(u){u&&d("navigate",{href:u})}j();var s=de(),b=m(s);q(b,1,e,G,(u,a,n)=>{var g=oe(),y=m(g);{var S=l=>{var h=le(),Z=m(h,!0);f(h),M(()=>D(Z,(t(a),L(()=>t(a).label)))),$("click",h,()=>i(t(a).href)),w(l,h)},k=l=>{var h=se(),Z=m(h,!0);f(h),M(()=>D(Z,(t(a),L(()=>t(a).label)))),w(l,h)};H(y,l=>{t(a),L(()=>t(a).href)?l(S):l(k,!1)})}var T=p(y,2);{var x=l=>{var h=ie();w(l,h)};H(T,l=>{R(e()),L(()=>n<e().length-1)&&l(x)})}f(g),w(u,g)});var o=p(b,2);{var _=u=>{var a=ce();w(u,a)};H(o,u=>{R(e()),L(()=>!e()?.length)&&u(_)})}f(s),w(c,s),B()}var ue=C('<label class="block text-sm font-medium" for="scene-id-input"> </label> <input id="scene-id-input" aria-describedby="sceneid-help"/> <p id="sceneid-help"><!></p>',1);function ve(c,r){z(r,!1);const e=E(),d=O();let i=I(r,"value",12,""),s=I(r,"label",8,"Scene ID");const b=/^[A-Za-z_][A-Za-z0-9_]*$/;function o(l){i(l.target.value),d("change",{value:i(),valid:t(e)})}X(()=>R(i()),()=>{A(e,b.test(i()))}),Y(),j();var _=ue(),u=F(_),a=m(u,!0);f(u);var n=p(u,2);K(n);let g;var y=p(n,2);let S;var k=m(y);{var T=l=>{var h=J("Must be a valid C identifier.");w(l,h)},x=l=>{var h=J("Invalid ID. Use letters, digits, and underscores; start with letter or underscore.");w(l,h)};H(k,l=>{t(e)?l(T):l(x,!1)})}f(y),M((l,h)=>{D(a,s()),g=W(n,1,"mt-1 w-full rounded border px-2 py-1",null,g,l),Q(n,"aria-invalid",!t(e)),S=W(y,1,"text-xs mt-1",null,S,h)},[()=>({"border-red-500":!t(e),"border-gray-300":t(e)}),()=>({"text-red-600":!t(e),"text-gray-500":t(e)})]),V(n,i),$("input",n,o),w(c,_),B()}async function pe(){return N.getAllChapters()}async function Re(){return N.getAllScenes()}async function Ve(c){return N.createChapter(c)}async function He(c){return N.createScene(c)}async function Ke(c,r){return N.updateScene(c,r)}async function Oe(c){return N.deleteScene(c)}var fe=C("<option> </option>"),be=C("<option disabled>(no chapters)</option>"),he=C('<label class="block text-sm font-medium" for="chapter-select"> </label> <select id="chapter-select" class="mt-1 w-full rounded border border-gray-300 px-2 py-1 bg-white dark:bg-gray-900"><option disabled> </option><!><!></select>',1);function ge(c,r){z(r,!1);let e=I(r,"value",12,""),d=I(r,"label",8,"Chapter"),i=I(r,"placeholder",8,"Select chapterâ€¦"),s=E([]);const b=O();ee(async()=>{try{A(s,await pe())}catch{A(s,[])}});function o(x){e(x.target.value),b("change",{chapterId:e()})}j();var _=he(),u=F(_),a=m(u,!0);f(u);var n=p(u,2);M(()=>{e(),U(()=>{d(),i(),t(s)})});var g=m(n),y=m(g,!0);f(g),g.value=g.__value="";var S=p(g);q(S,1,()=>t(s),G,(x,l)=>{var h=fe(),Z=m(h,!0);f(h);var v={};M(()=>{D(Z,(t(l),L(()=>t(l).title))),v!==(v=(t(l),L(()=>t(l).chapterId)))&&(h.value=(h.__value=(t(l),L(()=>t(l).chapterId)))??"")}),w(x,h)});var k=p(S);{var T=x=>{var l=be();l.value=l.__value="",w(x,l)};H(k,x=>{t(s),L(()=>t(s).length===0)&&x(T)})}f(n),M(()=>{D(a,d()),Q(n,"aria-label",d()),re(g,e()===""),D(y,i())}),ne(n,e),$("change",n,o),w(c,_),B()}var xe=C('<label class="block text-sm font-medium" for="scene-text-editor"> </label> <textarea id="scene-text-editor" class="mt-1 w-full rounded border border-gray-300 px-2 py-1 bg-white dark:bg-gray-900"></textarea> <div class="text-xs text-gray-500 mt-1" aria-live="polite"> </div>',1);function me(c,r){z(r,!1);let e=I(r,"value",12,""),d=I(r,"label",8,"Scene Text"),i=I(r,"maxLength",8,500);const s=O();function b(y){e(y.target.value),e().length>i()&&e(e().slice(0,i())),s("input",{value:e()})}j();var o=xe(),_=F(o),u=m(_,!0);f(_);var a=p(_,2);ae(a),Q(a,"rows",8);var n=p(a,2),g=m(n);f(n),M(()=>{D(u,d()),Q(a,"maxlength",i()),Q(a,"aria-label",d()),D(g,`${R(e()),L(()=>e().length)??""} / ${i()??""}`)}),V(a,e),$("input",a,b),w(c,o),B()}var _e=C('<li class="flex items-center gap-2 mb-1" data-testid="choice-row"><input class="flex-1 rounded border border-gray-300 px-2 py-1" placeholder="Choice text"/> <input class="w-40 rounded border border-gray-300 px-2 py-1" placeholder="Next scene id"/> <button class="px-2 py-1 rounded bg-red-600 text-white" aria-label="Remove choice">Ã—</button></li>'),ye=C('<div><div class="flex justify-between items-center mb-2"><h3 class="font-medium">Choices</h3> <button class="px-2 py-1 rounded bg-gray-100 dark:bg-gray-800" aria-label="Add choice">Add</button></div> <ul></ul></div>');function we(c,r){z(r,!1);let e=I(r,"items",28,()=>[]);const d=O();function i(){const a=`choice-${Math.random().toString(36).slice(2,6)}`;e([...e(),{id:a,text:""}]),d("change",{items:e()})}function s(a){e(e().filter(n=>n.id!==a)),d("change",{items:e()})}j();var b=ye(),o=m(b),_=p(m(o),2);f(o);var u=p(o,2);q(u,5,e,a=>a.id,(a,n,g)=>{var y=_e(),S=m(y);K(S);var k=p(S,2);K(k);var T=p(k,2);f(y),V(S,()=>t(n).text,x=>(t(n).text=x,U(()=>e()))),V(k,()=>t(n).next,x=>(t(n).next=x,U(()=>e()))),$("click",T,()=>s(t(n).id)),w(a,y)}),f(u),f(b),$("click",_,i),w(c,b),B()}var Se=C('<li class="flex items-center gap-2 mb-1" data-testid="state-row"><input class="w-40 rounded border border-gray-300 px-2 py-1" placeholder="Key"/> <input class="flex-1 rounded border border-gray-300 px-2 py-1" placeholder="Value"/> <button class="px-2 py-1 rounded bg-red-600 text-white" aria-label="Remove state change">Ã—</button></li>'),Ce=C('<div><div class="flex justify-between items-center mb-2"><h3 class="font-medium">State Changes</h3> <button class="px-2 py-1 rounded bg-gray-100 dark:bg-gray-800" aria-label="Add state change">Add</button></div> <ul></ul></div>');function ke(c,r){z(r,!1);let e=I(r,"items",28,()=>[]);const d=O();function i(){e([...e(),{key:"",value:""}]),d("change",{items:e()})}function s(a){e(e().filter((n,g)=>g!==a)),d("change",{items:e()})}j();var b=Ce(),o=m(b),_=p(m(o),2);f(o);var u=p(o,2);q(u,5,e,G,(a,n,g)=>{var y=Se(),S=m(y);K(S);var k=p(S,2);K(k);var T=p(k,2);f(y),V(S,()=>t(n).key,x=>(t(n).key=x,U(()=>e()))),V(k,()=>t(n).value,x=>(t(n).value=x,U(()=>e()))),$("click",T,()=>s(g)),w(a,y)}),f(u),f(b),$("click",_,i),w(c,b),B()}function Ie(c,r=[],e=[]){const d=`scene_${c.sceneId}`.replace(/[^A-Za-z0-9_]/g,"_"),i=`/* ${c.title} */
void ${d}(void) {`,s=[];if(c.sceneText&&s.push(`  // ${c.sceneText.replace(/\n/g," ")}`),r.length){s.push("  // Choices");for(const o of r)s.push(`  // - ${o.text}${o.next?` -> ${o.next}`:""}`)}if(e.length){s.push("  // State Changes");for(const o of e)s.push(`  // ${o.key} = ${o.value}`)}return[i,...s,`}
`].join(`
`)}var Ae=C('<pre class="text-xs bg-gray-900 text-gray-100 p-3 rounded overflow-auto" data-testid="code-preview"><code> </code></pre>');function Qe(c,r){z(r,!1);const e=E();let d=I(r,"scene",8),i=I(r,"choices",24,()=>[]),s=I(r,"state",24,()=>[]);X(()=>(R(d()),R(i()),R(s())),()=>{A(e,Ie(d(),i(),s()))}),Y(),j();var b=Ae(),o=m(b),_=m(o,!0);f(o),f(b),M(()=>D(_,t(e))),w(c,b),B()}var Te=C('<div data-testid="save-status"> </div>'),Le=C('<div class="space-y-4"><div><label class="block text-sm font-medium" for="scene-title">Title</label> <input id="scene-title" class="mt-1 w-full rounded border border-gray-300 px-2 py-1" aria-label="Title"/></div> <!> <!> <!> <!> <!> <button class="px-3 py-2 rounded bg-blue-600 text-white" data-testid="save-btn">Save</button> <!></div>');function Ue(c,r){z(r,!1);let e=I(r,"sceneId",12,null),d=E(""),i=E(""),s=E(""),b=E([]),o=E([]),_=E("");ee(async()=>{if(!e())return;const v=await N.getScene(e());v&&(A(d,v.chapterId),A(i,v.title),A(s,v.sceneText||""))});async function u(){const v=Date.now(),P={sceneId:e()||t(i).toLowerCase().replace(/\s+/g,"-"),chapterId:t(d),title:t(i),sceneText:t(s),createdAt:v,updatedAt:v};e()?await N.updateScene(e(),P):(await N.createScene(P),e(P.sceneId)),A(_,"saved")}j();var a=Le(),n=m(a),g=p(m(n),2);K(g),f(n);var y=p(n,2);ve(y,{label:"Scene ID",get value(){return e()},set value(v){e(v)},$$legacy:!0});var S=p(y,2);ge(S,{get value(){return t(d)},set value(v){A(d,v)},$$legacy:!0});var k=p(S,2);me(k,{maxLength:500,get value(){return t(s)},set value(v){A(s,v)},$$legacy:!0});var T=p(k,2);we(T,{get items(){return t(b)},set items(v){A(b,v)},$$legacy:!0});var x=p(T,2);ke(x,{get items(){return t(o)},set items(v){A(o,v)},$$legacy:!0});var l=p(x,2),h=p(l,2);{var Z=v=>{var P=Te(),te=m(P,!0);f(P),M(()=>D(te,t(_))),w(v,P)};H(h,v=>{t(_)&&v(Z)})}f(a),V(g,()=>t(i),v=>A(i,v)),$("click",l,u),w(c,a),B()}const qe=[{label:"Cards",href:"/cards",icon:"ğŸ“"},{label:"Scenes",href:"/cards/scenes",icon:"ğŸ“„"},{label:"Chapters",href:"/cards/chapters",icon:"ğŸ“š"},{label:"Scene Editor",href:"/cards/editor",icon:"âœï¸"},{label:"New Scene",href:"/cards/scene/new",icon:"â•"},{label:"New Chapter",href:"/cards/chapter/new",icon:"â•"},{label:"Table of Contents",href:"/cards/toc",icon:"ğŸ“‹"}];export{Pe as Breadcrumbs,ge as ChapterSelect,we as ChoicesList,Qe as CodePreview,Ue as SceneEditorView,ve as SceneIdInput,me as SceneTextEditor,ke as StateChangesList,qe as cardsMenu,Ve as createChapter,He as createScene,Oe as deleteScene,Ie as generateC,pe as getChapters,Re as getScenes,Ke as updateScene};
