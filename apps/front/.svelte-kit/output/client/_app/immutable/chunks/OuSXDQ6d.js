import"./DsnmJJEf.js";import"./BnfXkLE3.js";import{c as K,e as R,s as j,o as P}from"./CAKmdX18.js";import{p as z,aF as ae,aG as re,f as A,b as q,t as E,a as I,c as V,h as Q,s as n,g as t,m as T,e as g,d as S,r as m,aE as J,aj as G,u as Z,bb as le}from"./yF9IpEO4.js";import{i as B}from"./SV0_QZCG.js";import{s as F,r as M,a as se}from"./4O88iP2y.js";import{b as U}from"./jNOg69iZ.js";import{i as W}from"./CiABMiT9.js";import{p as L}from"./oaR_oenP.js";import{s as O}from"./DvVjvEKR.js";import{e as H,i as X}from"./BW16Smnj.js";import{b as ie}from"./D2rwkULN.js";import{w as ee}from"./CybAjIvC.js";var ne=A('<label class="block text-sm font-medium" for="scene-id-input"> </label> <input id="scene-id-input" aria-describedby="sceneid-help"/> <p id="sceneid-help"><!></p>',1);function oe(y,s){z(s,!1);const e=T(),v=K();let i=L(s,"value",12,""),p=L(s,"label",8,"Scene ID");const x=/^[A-Za-z_][A-Za-z0-9_]*$/;function f(l){i(l.target.value),v("change",{value:i(),valid:t(e)})}ae(()=>Q(i()),()=>{S(e,x.test(i()))}),re(),W();var h=ne(),c=q(h),r=g(c,!0);m(c);var a=n(c,2);M(a);let u;var b=n(a,2);let _;var w=g(b);{var D=l=>{var k=J("Must be a valid C identifier.");I(l,k)},d=l=>{var k=J("Invalid ID. Use letters, digits, and underscores; start with letter or underscore.");I(l,k)};B(w,l=>{t(e)?l(D):l(d,!1)})}m(b),E((l,k)=>{j(r,p()),u=O(a,1,"mt-1 w-full rounded border px-2 py-1",null,u,l),F(a,"aria-invalid",!t(e)),_=O(b,1,"text-xs mt-1",null,_,k)},[()=>({"border-red-500":!t(e),"border-gray-300":t(e)}),()=>({"text-red-600":!t(e),"text-gray-500":t(e)})]),U(a,i),R("input",a,f),I(y,h),V()}async function de(){const y=new SharedWorker(new URL(""+new URL("../workers/worker-D2xl7xYo.js",import.meta.url).href,import.meta.url),{type:"module"});return y.port.start(),ee(y.port).chapters.list()}var ce=A("<option> </option>"),ue=A("<option disabled>(no chapters)</option>"),ve=A('<label class="block text-sm font-medium" for="chapter-select"> </label> <select id="chapter-select" class="mt-1 w-full rounded border border-gray-300 px-2 py-1 bg-white dark:bg-gray-900"><option disabled> </option><!><!></select>',1);function pe(y,s){z(s,!1);let e=L(s,"value",12,""),v=L(s,"label",8,"Chapter"),i=L(s,"placeholder",8,"Select chapter…"),p=T([]);const x=K();P(async()=>{try{S(p,await de())}catch{S(p,[])}});function f(d){e(d.target.value),x("change",{chapterId:e()})}W();var h=ve(),c=q(h),r=g(c,!0);m(c);var a=n(c,2);E(()=>{e(),G(()=>{v(),i(),t(p)})});var u=g(a),b=g(u,!0);m(u),u.value=u.__value="";var _=n(u);H(_,1,()=>t(p),X,(d,l)=>{var k=ce(),N=g(k,!0);m(k);var $={};E(()=>{j(N,(t(l),Z(()=>t(l).title))),$!==($=(t(l),Z(()=>t(l).chapterId)))&&(k.value=(k.__value=(t(l),Z(()=>t(l).chapterId)))??"")}),I(d,k)});var w=n(_);{var D=d=>{var l=ue();l.value=l.__value="",I(d,l)};B(w,d=>{t(p),Z(()=>t(p).length===0)&&d(D)})}m(a),E(()=>{j(r,v()),F(a,"aria-label",v()),se(u,e()===""),j(b,i())}),ie(a,e),R("change",a,f),I(y,h),V()}var be=A('<label class="block text-sm font-medium" for="scene-text-editor"> </label> <textarea id="scene-text-editor" class="mt-1 w-full rounded border border-gray-300 px-2 py-1 bg-white dark:bg-gray-900"></textarea> <div class="text-xs text-gray-500 mt-1" aria-live="polite"> </div>',1);function me(y,s){z(s,!1);let e=L(s,"value",12,""),v=L(s,"label",8,"Scene Text"),i=L(s,"maxLength",8,500);const p=K();function x(b){e(b.target.value),e().length>i()&&e(e().slice(0,i())),p("input",{value:e()})}W();var f=be(),h=q(f),c=g(h,!0);m(h);var r=n(h,2);le(r),F(r,"rows",8);var a=n(r,2),u=g(a);m(a),E(()=>{j(c,v()),F(r,"maxlength",i()),F(r,"aria-label",v()),j(u,`${Q(e()),Z(()=>e().length)??""} / ${i()??""}`)}),U(r,e),R("input",r,x),I(y,f),V()}var fe=A('<li class="flex items-center gap-2 mb-1" data-testid="choice-row"><input class="flex-1 rounded border border-gray-300 px-2 py-1" placeholder="Choice text"/> <input class="w-40 rounded border border-gray-300 px-2 py-1" placeholder="Next scene id"/> <button class="px-2 py-1 rounded bg-red-600 text-white" aria-label="Remove choice">×</button></li>'),he=A('<div><div class="flex justify-between items-center mb-2"><h3 class="font-medium">Choices</h3> <button class="px-2 py-1 rounded bg-gray-100 dark:bg-gray-800" aria-label="Add choice">Add</button></div> <ul></ul></div>');function ge(y,s){z(s,!1);let e=L(s,"items",28,()=>[]);const v=K();function i(){const r=`choice-${Math.random().toString(36).slice(2,6)}`;e([...e(),{id:r,text:""}]),v("change",{items:e()})}function p(r){e(e().filter(a=>a.id!==r)),v("change",{items:e()})}W();var x=he(),f=g(x),h=n(g(f),2);m(f);var c=n(f,2);H(c,5,e,r=>r.id,(r,a,u)=>{var b=fe(),_=g(b);M(_);var w=n(_,2);M(w);var D=n(w,2);m(b),U(_,()=>t(a).text,d=>(t(a).text=d,G(()=>e()))),U(w,()=>t(a).next,d=>(t(a).next=d,G(()=>e()))),R("click",D,()=>p(t(a).id)),I(r,b)}),m(c),m(x),R("click",h,i),I(y,x),V()}var xe=A('<li class="flex items-center gap-2 mb-1" data-testid="state-row"><input class="w-40 rounded border border-gray-300 px-2 py-1" placeholder="Key"/> <input class="flex-1 rounded border border-gray-300 px-2 py-1" placeholder="Value"/> <button class="px-2 py-1 rounded bg-red-600 text-white" aria-label="Remove state change">×</button></li>'),_e=A('<div><div class="flex justify-between items-center mb-2"><h3 class="font-medium">State Changes</h3> <button class="px-2 py-1 rounded bg-gray-100 dark:bg-gray-800" aria-label="Add state change">Add</button></div> <ul></ul></div>');function ye(y,s){z(s,!1);let e=L(s,"items",28,()=>[]);const v=K();function i(){e([...e(),{key:"",value:""}]),v("change",{items:e()})}function p(r){e(e().filter((a,u)=>u!==r)),v("change",{items:e()})}W();var x=_e(),f=g(x),h=n(g(f),2);m(f);var c=n(f,2);H(c,5,e,X,(r,a,u)=>{var b=xe(),_=g(b);M(_);var w=n(_,2);M(w);var D=n(w,2);m(b),U(_,()=>t(a).key,d=>(t(a).key=d,G(()=>e()))),U(w,()=>t(a).value,d=>(t(a).value=d,G(()=>e()))),R("click",D,()=>p(u)),I(r,b)}),m(c),m(x),R("click",h,i),I(y,x),V()}var we=A('<div data-testid="save-status"> </div>'),ke=A('<div class="space-y-4"><div><label class="block text-sm font-medium" for="scene-title">Title</label> <input id="scene-title" class="mt-1 w-full rounded border border-gray-300 px-2 py-1" aria-label="Title"/></div> <!> <!> <!> <!> <!> <button class="px-3 py-2 rounded bg-blue-600 text-white" data-testid="save-btn">Save</button> <!></div>');function Ve(y,s){z(s,!1);let e=L(s,"sceneId",12,null),v=T(""),i=T(""),p=T(""),x=T([]),f=T([]),h=T(""),c=null;function r(){if(c)return c;const o=new SharedWorker(new URL(""+new URL("../workers/worker-D2xl7xYo.js",import.meta.url).href,import.meta.url),{type:"module"});return o.port.start(),c=ee(o.port),c}P(async()=>{if(!e())return;const C=await r().cards.get(e());C&&(S(v,C.chapterId),S(i,C.title),S(p,C.sceneText||""))});async function a(){const o=r(),C=Date.now(),Y={sceneId:e()||t(i).toLowerCase().replace(/\s+/g,"-"),chapterId:t(v),title:t(i),sceneText:t(p),createdAt:C,updatedAt:C};e()?await o.cards.update(Y):(await o.cards.create(Y),e(Y.sceneId)),S(h,"saved")}W();var u=ke(),b=g(u),_=n(g(b),2);M(_),m(b);var w=n(b,2);oe(w,{label:"Scene ID",get value(){return e()},set value(o){e(o)},$$legacy:!0});var D=n(w,2);pe(D,{get value(){return t(v)},set value(o){S(v,o)},$$legacy:!0});var d=n(D,2);me(d,{maxLength:500,get value(){return t(p)},set value(o){S(p,o)},$$legacy:!0});var l=n(d,2);ge(l,{get items(){return t(x)},set items(o){S(x,o)},$$legacy:!0});var k=n(l,2);ye(k,{get items(){return t(f)},set items(o){S(f,o)},$$legacy:!0});var N=n(k,2),$=n(N,2);{var te=o=>{var C=we(),Y=g(C,!0);m(C),E(()=>j(Y,t(h))),I(o,C)};B($,o=>{t(h)&&o(te)})}m(u),U(_,()=>t(i),o=>S(i,o)),R("click",N,a),I(y,u),V()}export{pe as C,Ve as S,oe as a,me as b,ge as c,ye as d};
